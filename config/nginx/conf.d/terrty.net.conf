server {
	include /etc/nginx/ssl.conf;

	listen 443 deferred http2 reuseport ssl;
	listen [::]:443 deferred http2 reuseport ssl;
	server_name terrty.net;
	root /usr/share/nginx/html;

	location / {
		try_files $uri $uri/ =404;
	}

	location = /atom.xml {
		return 301 https://terrty.net/index.xml;
	}

	location /cv/ {
		autoindex on;
	}

	# generic part
    location ~ /\. {
    	access_log off;
    	log_not_found off;
    	deny all;
    }

    location ~ ~$ {
    	access_log off;
    	log_not_found off;
    	deny all;
    }

    location ~* ^/(robots.txt|favicon.ico|favicon.png)$  {
    	access_log off;
    	log_not_found off;
    	expires 1y;
    	add_header Cache-Control public,max-age=259200;
        // re-add security headers
    	add_header Strict-Transport-Security 'max-age=31536000; includeSubdomains; preload' always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
    }

    location ~* \.(jpg|jpeg|svg|png|gif|ico|css|js|mp3)$ {
    	expires 30d;
    	add_header Cache-Control public,max-age=259200;
        // re-add security headers
    	add_header Strict-Transport-Security 'max-age=31536000; includeSubdomains; preload' always;
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
    }
}

server {
	listen 80 default_server;
	listen [::]:80 default_server;
	server_name .terrty.net .terrty.com;
    return 301 https://terrty.net$request_uri;
}
